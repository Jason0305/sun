<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>登录</title>
    <script type="text/javascript" src="../js/jquery-3.1.1.min.js"></script>
    <script type="text/javascript" src="../js/jquery1.42.min.js"></script>
    <script type="text/javascript" src="../js/jquery.SuperSlide.2.1.1.js"></script>
    <script type="text/javascript" src="../js/publicNav.js"></script>
    <script type="text/javascript" src="../js/jquery.blockUI.js"></script>
    <script type="text/javascript" src="../js/jquery.cookie.js"></script>
    <script type="text/javascript" src="../js"></script>
    <!--<script type="text/javascript" src="js/formDataCheck.js"></script>-->
    <link rel="stylesheet" type="text/css" href="../css/base.css"/>
</head>

<body>

<!--引入top_block-->
<script type="text/javascript">
    $("body").append($("<div id='top_block'></div>").load("page_top.html"));
</script>
<!--引入top_block-->


<div class="logo_blk">
    <div class="logo">
        <a href="index.html"><img src="../images/logos.gif" width="260" height="75"></a>
    </div>
</div>
<div class="jdCont" style="background: #f5f5f5;height: 390px;width: 1015px;">
    <div class="login_box">
        <div class="pic">
            <img src="../images/login_bg.jpg"/>
        </div>
        <div class="login_form">
            <form id="loginForm">
                <h3 style="font-size:15px;">宠物商城</h3>
                <div class="login_list">
                    <p class="login_cont">
                        <input type="text" class="login_input style_border" value="邮箱/手机号/昵称"
                               name="username" id="login_user" autocomplete="off" maxlength="20">
                        <span class="user_icon"></span>
                        <span class="uname_correct"><img src='../images/right.gif' alt=""/></span>
                        <!--<label for="login_user" class="prompt_login">邮箱/手机号/昵称</label>-->
                        <span id="login_uname_tip" class="msg_error"></span>
                    </p>
                </div>
                <div class="login_list">
                    <p class="login_cont">
                        <input class="login_input style_border" type="text" value="密码"
                               name="password" id="password" maxlength="20"/>
                        <span class="pwd_icon"></span>
                        <!--<label for="password" class="prompt_login">密码</label>-->
                        <span id="login_pwd_tip" class="msg_error"></span>
                    </p>
                </div>
                <div class="login_options">
                    <input type="checkbox" id="autoLogin">
                    <label for="autoLogin">记住密码</label>
                    <span>
                    <a href="#" class="login_to">忘记密码</a>
                    <span>&nbsp;|&nbsp;</span><a href="reg.html" class="login_to">免费注册</a>
                </span>
                </div>
            </form>
            <div class="login_btn_wrap">
                <button type="button" class="login_btn" id="loginBtn">立即登录</button>
            </div>

            <div class="fast_login">
                <h3>合作网站账户登录</h3>
                <div class="fast_way">
                    <a href="javascript:" class="qq_way"></a>
                    <a href="javascript:;" class="sina_way"></a>
                    <a href="javascript:;" class="weixin_way"></a>
                </div>
                <div class="more_way_wrap">
                    <a><h4>更多登录方式&gt;&gt;</h4></a>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    // console.log("邮箱: " + FormReg.formCheck("2141243@qq.com", "邮箱", "email,phone,username",));
    $(function () {
        $(".login_input").focus(function () {
            $(this).addClass("login_focus").removeClass("style_border");
            if ($(this).val() === this.defaultValue) {
                $(this).val("");
            }
        }).blur(function () {
            $(this).removeClass("login_focus").addClass("style_border");
            if ($(this).val() === "") {
                $(this).val(this.defaultValue);
            }
        });

        $("#login_user").focus(function () {
            $(this).nextAll("span:eq(1)").css("display", "none");
            $(this).nextAll("span:last").text("请输入您的用户名或注册邮箱！").css("color", "#666");
        }).blur(function () {
            const loginInput = this;
            const username = this.value;

            // const isCorrect = FormReg.formCheck(username, "用户名", "username",);
            if (username == null || username === "" || username === this.defaultValue) {
                $(this).addClass("style_border").removeClass("style_error");
                $(this).nextAll("span:last").text("用户名不能为空！").css("color", "red");
            } else if (!/^[\u4E00-\u9FA5\w_]{2,16}$/.test(username)) {
                $(this).css("border", "red");
                $(this).nextAll("span:last").text("用户名格式不正确，请重新检查！").css("color", "red");
            } else {
                $.ajax({
                    url: "user/username_check.do",
                    type: "get",
                    data: "username=" + username,
                    dataType: "json",
                    before: function () {
                        $(loginInput).nextAll("span:last").text("正在查询");
                    },
                    success: function (data) {
                        if (data.status) {
                            $(this).css("border", "red");
                            $(loginInput).nextAll("span:last").text("");
                            $(loginInput).nextAll("span:eq(1)").css("display", "block");
                        } else {
                            $(this).css("border", "red");
                            $(loginInput).nextAll("span:last").text("用户名不存在，请重新确认！");
                        }

                    }
                })
            }
        });


        /** 当密码输入框内容改变，校验合法性 */
        $("#password").focus(function () {
            $(this).nextAll("span:last").text("请输入至少6位以字母开头，数字或符号!").css("color", "#666");
        }).blur(function () {
            const value = this.value;
            if (password == null || password === '') {
                $(this).css("border", "red");
                $(this).nextAll("span:last").text("请输入至少6位以字母开头，数字或符号!").css("color", "red");
            } else if (password.length < 6) {
                $(this).nextAll("span:last").text("密码格式不正确，请重新检查！").css("color", "red");
            } else {
                $(this).nextAll("span:last").text("")
            }
        });

        /** 页面加载时将记住的密码信息填充到页面 */
        $(function () {
            //页面加载先前记录的用户信息并选择填充到页面
            if ($.cookie("isAutoLogin") === "true") {
                $("#autoLogin").attr({checked: "checked"});
                $("#loginForm input[name='username']").val($.cookie("username"));
                $("#loginForm input[name='password']").val($.cookie("password"));
            }
        });

        function formTip(dom, msg, isRight) {
            let color = isRight ? green : red;
            $(dom).next().text(msg);
        }

        /** 记住密码 */
        function rememberUserInfo() {
            if ($("#autoLogin").is(":checked")) {
                $.cookie("isAutoLogin", "true", {expires: 7});
                $.cookie("username", $("#loginForm input[name='username']").val(), {expires: 7});
                $.cookie("password", $("#loginForm input[name='password']").val(), {expires: 7});
            } else {
                $.cookie("isAutoLogin", "false");
                $.cookie("username", null);
                $.cookie("password", null);
            }
        }

        /** 执行登录操作 */
        $("#loginBtn").click(function () {
            console.log("cookie.password:" + $.cookie("password"));
            $.ajax({
                url: "user/handle_login.do",
                data: $("#loginForm").serialize(),
                type: "get",
                dataType: "json",
                beforeSend: function () {
                    console.log("send Before...");
                    $.blockUI({message: '<h1>Just a moment...</h1>'});
                },
                success: function (data) {
                    console.log("登录返回状态码:" + data.status);
                    console.log("Login.ajax.success()...");
                    if (data.status === 600) {
                        rememberUserInfo();
                        location.href = "index.html"
                    } else if (data.status === 601) {
                        alert("用户不存在！");
                    } else if (data.status === 602) {
                        $("#login_pwd_tip").text("密码不正确，请重新检查！").css("color", "red");
                    }
                },
                complete() {
                    setTimeout($.unblockUI, 200);
                }
            });
        });

        /** 账号第三方登录功能不可用提示 */
        $(".fast_login a").bind("click", function () {
            alert("该功能暂未开通！敬请期待！");
            return false;
        });
    });
</script>


<script type="text/javascript">
    $(function () {
        $("body").append($("<div id='rightBar'></div>").load("page_rightBar.html"))
            .append($("<div id=footer''></div>").load("page_footer.html"));
    })
</script>
</body>
</html>
